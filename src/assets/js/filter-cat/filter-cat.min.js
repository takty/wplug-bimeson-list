"use strict";export default class f{static#M=0;static constructAll(e={}){const t=typeof(e.selFilter??null)=="string"?e.selFilter:".filter",s=typeof(e.selList??null)=="string"?e.selList:".list",n=Array.from(document.querySelectorAll(`${t}:not([for])`)),i=Array.from(document.querySelectorAll(`${s}:not([id])`));for(const r of n){const l=i.shift();if(!l)break;const a=`fl${f.#M++}`;r.setAttribute("for",String(a)),l.setAttribute("id",String(a)),new f(a,e)}}static#r(e,t){const s=e[t]??"";return s.length?s:null}#g=".filter";#d=".list";#m=".filter-key";#l=".filter-select";#a=".filter-enabled";#o=".filter-relation";#c=".filter-values";#y="%key%";#L="qvarBase";#b="qvar";#v="%value%";#f="classBase";#h="key";#t="count";#s="depth";#k=!0;#E=!0;#e;#n=new Map;#u=!1;constructor(e,t={}){this.#T(t);const s=document.querySelector(`${this.#g}[for="${e}"]`),n=document.querySelector(`${this.#d}#${e}`);if(!s||!n)throw new Error;this.#e=n,this.#K(),this.#H(e,s),s.removeAttribute("hidden")}#T(e={}){typeof(e.selFilter??null)=="string"&&(this.#g=e.selFilter),typeof(e.selList??null)=="string"&&(this.#d=e.selList),typeof(e.selFilterKey??null)=="string"&&(this.#m=e.selFilterKey),typeof(e.selFilterSelect??null)=="string"&&(this.#l=e.selFilterSelect),typeof(e.selFilterEnabled??null)=="string"&&(this.#a=e.selFilterEnabled),typeof(e.selFilterRelation??null)=="string"&&(this.#o=e.selFilterRelation),typeof(e.selFilterValues??null)=="string"&&(this.#c=e.selFilterValues),typeof(e.qvarBase??null)=="string"&&(this.#y=e.qvarBase),typeof(e.dsQvarBase??null)=="string"&&(this.#L=e.dsQvarBase),typeof(e.dsQvar??null)=="string"&&(this.#b=e.dsQvar),typeof(e.classBase??null)=="string"&&(this.#v=e.classBase),typeof(e.dsClassBase??null)=="string"&&(this.#f=e.dsClassBase),typeof(e.dsKey??null)=="string"&&(this.#h=e.dsKey),typeof(e.dsCount??null)=="string"&&(this.#t=e.dsCount),typeof(e.dsDepth??null)=="string"&&(this.#s=e.dsDepth),typeof(e.doSetHeadingDepth??null)=="boolean"&&(this.#k=e.doSetHeadingDepth),typeof(e.doInitializeByParams??null)=="boolean"&&(this.#E=e.doInitializeByParams)}#H(e,t){const s=Array.from(t.querySelectorAll(this.#m));this.#S(e,s);const n=f.#r(t.dataset,this.#L)??this.#y,i=f.#r(t.dataset,this.#f)??this.#v;for(const r of s){const l=r.dataset[this.#h];if(!l)continue;const a=f.#r(r.dataset,this.#b)??n.replace("%key%",l),o=(f.#r(r.dataset,this.#f)??i).replace("%key%",l),c=r.querySelector(this.#l);if(c)this.#n.set(l,[o,a,"select",[c,null,null]]);else{const u=r.querySelector(this.#a),g=r.querySelector(this.#o),h=Array.from(r.querySelectorAll(this.#c+" input"));this.#n.set(l,[o,a,"checkbox",[u,g,h]])}}for(const[r,[l,a,o,c]]of this.#n)this.#I(o,c);this.#E&&(this.#u=!0,this.#F(),this.#u=!1),this.#i()}#S(e,t){for(const n of t){const i=n.dataset[this.#h];if(!i)continue;s(n,this.#a,i,"enabled",e),s(n,this.#o,i,"relation",e);const r=n.querySelector(this.#l);r&&(r.name=`select-${i}`);const l=Array.from(n.querySelectorAll(this.#c+" input"));for(const a of l)a.name=`${i}-${a.value}`}function s(n,i,r,l,a){const o=n.querySelector(i);if(!o)return;o.id=`${l}-${r}-${a}`;let c=o;for(;c.nextElementSibling&&(c=c.nextElementSibling,c.tagName==="LABEL");)c.setAttribute("for",o.id)}}#i(){if(this.#u)return;const e=this.#q();this.#V(),this.#w(e),this.#D(),this.#x(),this.#$(e)}#I(e,t){if(e==="select"){const[s]=t;s.addEventListener("change",()=>this.#i())}else if(e==="checkbox"){const[s,n,i]=t;if(s&&i){s.addEventListener("click",()=>{if(s.checked&&!this.#p(i))for(const r of i)r.checked=!0;if(!s.checked&&this.#A(i))for(const r of i)r.checked=!1;this.#i()});for(const r of i)r.addEventListener("click",()=>{s.checked=this.#p(i),this.#i()})}n&&n.addEventListener("click",()=>this.#i())}}#p(e){for(const t of e)if(t.checked)return!0;return!1}#A(e){for(const t of e)if(!t.checked)return!1;return!0}#q(){const e=new Map;for(const[t,[s,n,i,r]]of this.#n)if(i==="select"){const[l]=r;l&&l.value!==""&&e.set(t,["or",[l.value],s,n])}else if(i==="checkbox"){const[l,a,o]=r;if(o&&l&&l.checked){const c=a&&a.checked?"and":"or";e.set(t,[c,this.#B(o),s,n])}}return e}#B(e){const t=[];for(const s of e)s.checked&&t.push(s.value);return t}#F(){const e=new URLSearchParams(document.location.search);for(const[t,[s,n,i,r]]of this.#n){if(!e.has(n))continue;let l=e.get(n),a="or";if(l.startsWith(".")&&(l=l.substring(1),a="and"),i==="select"){const[o]=r;o.value=l}else if(i==="checkbox"){const[o,c,u]=r;if(o&&(o.checked=!0),c&&(c.checked=a==="and"),u){const g=new Set(l.split(",").map(h=>h.trim()));for(const h of u)h.checked=g.has(h.value)}}}}#$(e){const t={or:"",and:"."},s=[];for(const[i,[r,l,a,o]]of e)l.length&&s.push(`${o}=${t[r]}${l.join(",")}`);let n;s.length>0?n="?"+s.join("&"):n=document.location.origin+document.location.pathname,history.replaceState("","",n+document.location.hash)}#K(){const e=()=>{for(const t of this.#e.children)t instanceof HTMLHeadingElement&&(t.dataset[this.#s]=String(parseInt(t.tagName[1])-1))};this.#k&&e()}#V(){for(const e of this.#e.children){if(!(e instanceof HTMLElement)||e.tagName!=="OL"&&e.tagName!=="UL")continue;const t=e.offsetHeight;e.setAttribute("style",`--height:${t}px;`)}}#x(){for(const e of this.#e.children)e instanceof HTMLElement&&(e.tagName!=="OL"&&e.tagName!=="UL"||e.removeAttribute("style"))}#w(e){for(const t of this.#e.children){if(!(t instanceof HTMLElement)||t.tagName!=="OL"&&t.tagName!=="UL")continue;let s=0;for(const n of t.children)n.tagName==="LI"&&(this.#N(n,e)?(s+=1,n.removeAttribute("hidden")):n.setAttribute("hidden",""));t.dataset[this.#t]=String(s)}}#N(e,t){for(const[s,[n,i,r]]of t)if(!this.#U(e,i,r,n==="or"))return!1;return!0}#U(e,t,s,n){if(n){for(const i of t){const r=s.replace("%value%",i).replace("_","-");if(e.classList.contains(r))return!0}return!1}else{for(const i of t){const r=s.replace("%value%",i).replace("_","-");if(!e.classList.contains(r))return!1}return!0}}#D(){for(const t of this.#e.children)t instanceof HTMLElement&&t.dataset[this.#s]&&(t.dataset[this.#t]="0");const e=[];for(const t of this.#e.children)if(t instanceof HTMLElement)if(t.dataset[this.#s]){const s=parseInt(t.dataset[this.#s]??"");for(;e.length>0;){const n=e[e.length-1];if(s>parseInt(n.dataset[this.#s]??""))break;e.length-=1}e.push(t)}else{const s=parseInt(t.dataset[this.#t]??"");for(const n of e){const i=parseInt(n.dataset[this.#t]??"")+s;n.dataset[this.#t]=String(i),i?n.removeAttribute("hidden"):n.setAttribute("hidden","")}}}}
//# sourceMappingURL=filter-cat.min.js.map
