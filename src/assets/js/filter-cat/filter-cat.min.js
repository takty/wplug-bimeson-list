"use strict";export default class f{static#A=0;static constructAll(e={}){const s=typeof(e.selFilter??null)=="string"?e.selFilter:".filter",t=typeof(e.selList??null)=="string"?e.selList:".list",i=Array.from(document.querySelectorAll(`${s}:not([for])`)),n=Array.from(document.querySelectorAll(`${t}:not([id])`));for(const l of i){const r=n.shift();if(!r)break;const o=`fl${f.#A++}`;l.setAttribute("for",String(o)),r.setAttribute("id",String(o)),new f(o,e)}}static#l(e,s){const t=e[s]??"";return t.length?t:null}#d=".filter";#g=".list";#m=".filter-key";#r=".filter-select";#o=".filter-enabled";#a=".filter-relation";#c=".filter-values";#y="%key%";#L="qvarBase";#b="qvar";#E="%value%";#f="classBase";#h="key";#s="count";#e="depth";#v=!0;#p=!0;#I=!0;#t;#n=new Map;#u=!1;constructor(e,s={}){this.#q(s);const t=document.querySelector(`${this.#d}[for="${e}"]`),i=document.querySelector(`${this.#g}#${e}`);if(!t||!i)throw new Error;this.#t=i,this.#M(),this.#B(e,t),t.removeAttribute("hidden"),this.#I&&new MutationObserver(l=>{for(const r of l)r.type==="childList"&&this.#$(r.addedNodes[0])}).observe(this.#t,{childList:!0})}#q(e={}){typeof(e.selFilter??null)=="string"&&(this.#d=e.selFilter),typeof(e.selList??null)=="string"&&(this.#g=e.selList),typeof(e.selFilterKey??null)=="string"&&(this.#m=e.selFilterKey),typeof(e.selFilterSelect??null)=="string"&&(this.#r=e.selFilterSelect),typeof(e.selFilterEnabled??null)=="string"&&(this.#o=e.selFilterEnabled),typeof(e.selFilterRelation??null)=="string"&&(this.#a=e.selFilterRelation),typeof(e.selFilterValues??null)=="string"&&(this.#c=e.selFilterValues),typeof(e.qvarBase??null)=="string"&&(this.#y=e.qvarBase),typeof(e.dsQvarBase??null)=="string"&&(this.#L=e.dsQvarBase),typeof(e.dsQvar??null)=="string"&&(this.#b=e.dsQvar),typeof(e.classBase??null)=="string"&&(this.#E=e.classBase),typeof(e.dsClassBase??null)=="string"&&(this.#f=e.dsClassBase),typeof(e.dsKey??null)=="string"&&(this.#h=e.dsKey),typeof(e.dsCount??null)=="string"&&(this.#s=e.dsCount),typeof(e.dsDepth??null)=="string"&&(this.#e=e.dsDepth),typeof(e.doSetHeadingDepth??null)=="boolean"&&(this.#v=e.doSetHeadingDepth),typeof(e.doInitializeByParams??null)=="boolean"&&(this.#p=e.doInitializeByParams)}#B(e,s){const t=Array.from(s.querySelectorAll(this.#m));this.#F(e,t);const i=f.#l(s.dataset,this.#L)??this.#y,n=f.#l(s.dataset,this.#f)??this.#E;for(const l of t){const r=l.dataset[this.#h];if(!r)continue;const o=f.#l(l.dataset,this.#b)??i.replace("%key%",r),a=(f.#l(l.dataset,this.#f)??n).replace("%key%",r),c=l.querySelector(this.#r);if(c)this.#n.set(r,[a,o,"select",[c,null,null]]);else{const u=l.querySelector(this.#o),d=l.querySelector(this.#a),h=Array.from(l.querySelectorAll(this.#c+" input"));this.#n.set(r,[a,o,"checkbox",[u,d,h]])}}for(const[l,[r,o,a,c]]of this.#n)this.#x(a,c);this.#p&&(this.#u=!0,this.#w(),this.#u=!1),this.#i()}#F(e,s){for(const i of s){const n=i.dataset[this.#h];if(!n)continue;t(i,this.#o,n,"enabled",e),t(i,this.#a,n,"relation",e);const l=i.querySelector(this.#r);l&&(l.name=`select-${n}`);const r=Array.from(i.querySelectorAll(this.#c+" input"));for(const o of r)o.name=`${n}-${o.value}`}function t(i,n,l,r,o){const a=i.querySelector(n);if(!a)return;a.id=`${r}-${l}-${o}`;let c=a;for(;c.nextElementSibling&&(c=c.nextElementSibling,c.tagName==="LABEL");)c.setAttribute("for",a.id)}}#i(){if(this.#u)return;const e=this.#H();this.#O(),this.#T(e),this.#S(),this.#C(),this.#U(e)}#$(e=null){const s=this.#H();this.#M(e),this.#T(s,e),this.#S(e)}#x(e,s){if(e==="select"){const[t]=s;t.addEventListener("change",()=>this.#i())}else if(e==="checkbox"){const[t,i,n]=s;if(t&&n){t.addEventListener("click",()=>{if(t.checked&&!this.#k(n))for(const l of n)l.checked=!0;if(!t.checked&&this.#K(n))for(const l of n)l.checked=!1;this.#i()});for(const l of n)l.addEventListener("click",()=>{t.checked=this.#k(n),this.#i()})}i&&i.addEventListener("click",()=>this.#i())}}#k(e){for(const s of e)if(s.checked)return!0;return!1}#K(e){for(const s of e)if(!s.checked)return!1;return!0}#H(){const e=new Map;for(const[s,[t,i,n,l]]of this.#n)if(n==="select"){const[r]=l;r&&r.value!==""&&e.set(s,["or",[r.value],t,i])}else if(n==="checkbox"){const[r,o,a]=l;if(a&&r&&r.checked){const c=o&&o.checked?"and":"or";e.set(s,[c,this.#V(a),t,i])}}return e}#V(e){const s=[];for(const t of e)t.checked&&s.push(t.value);return s}#w(){const e=new URLSearchParams(document.location.search);for(const[s,[t,i,n,l]]of this.#n){if(!e.has(i))continue;let r=e.get(i),o="or";if(r.startsWith(".")&&(r=r.substring(1),o="and"),n==="select"){const[a]=l;a.value=r}else if(n==="checkbox"){const[a,c,u]=l;if(a&&(a.checked=!0),c&&(c.checked=o==="and"),u){const d=new Set(r.split(",").map(h=>h.trim()));for(const h of u)h.checked=d.has(h.value)}}}}#U(e){const s={or:"",and:"."},t=[];for(const[n,[l,r,o,a]]of e)r.length&&t.push(`${a}=${s[l]}${r.join(",")}`);let i;t.length>0?i="?"+t.join("&"):i=document.location.origin+document.location.pathname,history.replaceState("","",i+document.location.hash)}#M(e=null){if(this.#v){e||(e=this.#t.firstElementChild);for(let s=e;s;s=s?.nextElementSibling)s instanceof HTMLHeadingElement&&(s.dataset[this.#e]=String(parseInt(s.tagName[1])-1))}}#O(){for(const e of this.#t.children)(e instanceof HTMLOListElement||e instanceof HTMLUListElement)&&e.setAttribute("style",`--height:${e.offsetHeight}px;`)}#C(){for(const e of this.#t.children)(e instanceof HTMLOListElement||e instanceof HTMLUListElement)&&e.removeAttribute("style")}#T(e,s=null){s||(s=this.#t.firstElementChild);for(let t=s;t;t=t?.nextElementSibling){if(!(t instanceof HTMLOListElement||t instanceof HTMLUListElement))continue;let i=0;for(const n of t.children)n.tagName==="LI"&&(this.#D(n,e)?(i+=1,n.removeAttribute("hidden")):n.setAttribute("hidden",""));t.dataset[this.#s]=String(i)}}#D(e,s){for(const[t,[i,n,l]]of s)if(!this.#P(e,n,l,i==="or"))return!1;return!0}#P(e,s,t,i){if(i){for(const n of s){const l=t.replace("%value%",n).replace("_","-");if(e.classList.contains(l))return!0}return!1}else{for(const n of s){const l=t.replace("%value%",n).replace("_","-");if(!e.classList.contains(l))return!1}return!0}}#S(e=null){e||(e=this.#t.firstElementChild);for(let t=e;t;t=t?.nextElementSibling)t instanceof HTMLHeadingElement&&t.dataset[this.#e]&&(t.dataset[this.#s]="0");const s=[];for(let t=e?.previousElementSibling;t;t=t?.previousElementSibling)if(t instanceof HTMLHeadingElement&&t.dataset[this.#e]){const i=parseInt(t.dataset[this.#e]??"");(!s.length||i<s[0][1])&&s.unshift([t,i])}for(let t=e;t;t=t?.nextElementSibling)if(t instanceof HTMLHeadingElement&&t.dataset[this.#e]){const i=parseInt(t.dataset[this.#e]??"");for(;s.length>0&&!(i>s[s.length-1][1]);)s.length-=1;s.push([t,i])}else if(t instanceof HTMLOListElement||t instanceof HTMLUListElement){const i=parseInt(t.dataset[this.#s]??"");for(const[n]of s){const l=parseInt(n.dataset[this.#s]??"")+i;n.dataset[this.#s]=String(l),l?n.removeAttribute("hidden"):n.setAttribute("hidden","")}}}}
//# sourceMappingURL=filter-cat.min.js.map
