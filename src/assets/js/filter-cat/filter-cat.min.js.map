{
  "version": 3,
  "sources": ["../src/filter-cat.ts"],
  "sourcesContent": ["/**\n * Filter class for constructing and managing filters on a page.\n *\n * @author Takuto Yanagida\n * @version 2024-01-26\n *\n * @remarks\n * This class provides functionality to construct and manage filters on a page.\n * Filters can be applied to lists based on user-selected criteria.\n * @public\n */\n\ntype KeyToVals = Map<string, ['or'|'and', string[], string, string]>;\n\nexport default class FilterCat {\n\tstatic #idx: number = 0;\n\n\t/**\n\t * Constructs all filters on a page based on specified options.\n\t *\n\t * @param opts - Options for filter construction.\n\t */\n\tstatic constructAll(opts = {} as {[k in string]: string|boolean}) {\n\t\tconst selFilter = (typeof (opts['selFilter'] ?? null) === 'string') ? opts['selFilter'] as string : '.filter';\n\t\tconst selList   = (typeof (opts['selList']   ?? null) === 'string') ? opts['selList']   as string : '.list';\n\n\t\tconst fs = Array.from(document.querySelectorAll(`${selFilter}:not([for])`));\n\t\tconst ls = Array.from(document.querySelectorAll(`${selList}:not([id])`));\n\n\t\tfor (const f of fs) {\n\t\t\tconst l = ls.shift();\n\t\t\tif (!l) break;\n\n\t\t\tconst id = String(`fl${FilterCat.#idx++}`);\n\t\t\tf.setAttribute('for', String(id));\n\t\t\tl.setAttribute('id', String(id));\n\n\t\t\tnew FilterCat(id, opts);\n\t\t}\n\t}\n\n\t/**\n\t * Retrieves a non-empty value from the provided data map based on the given key.\n\t *\n\t * @private\n\t * @param arr - Data map (dataset).\n\t * @param key - Key to retrieve the value for.\n\t * @returns Non-empty value or null if not found.\n\t */\n\tstatic #nonEmpty(arr: DOMStringMap, key: string): string|null {\n\t\tconst v = arr[key] ?? '';\n\t\treturn v.length ? v : null;\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\t#selFilter: string = '.filter';\n\t#selList  : string = '.list';\n\n\t#selFilterKey: string = '.filter-key';\n\n\t#selFilterSelect  : string =  '.filter-select';\n\t#selFilterEnabled : string =  '.filter-enabled';\n\t#selFilterRelation: string =  '.filter-relation';\n\t#selFilterValues  : string =  '.filter-values';\n\n\t#qvarBase  : string = '%key%';  // Base of query variable names ('%key%' is replaced by the key).\n\t#dsQvarBase: string = 'qvarBase';  // Make sure to convert it to a snake case when writing within a tag.\n\t#dsQvar    : string = 'qvar';\n\n\t#classBase  : string = '%value%';  // Base of value class names ('%key%' and '%value%' are replaced by the key and the value).\n\t#dsClassBase: string = 'classBase';  // Make sure to convert it to a snake case when writing within a tag.\n\n\t#dsKey  : string = 'key';    // For filters.\n\t#dsCount: string = 'count';  // For headings and lists\n\t#dsDepth: string = 'depth';  // For headings\n\n\t#doSetHeadingDepth   : boolean = true;\n\t#doInitializeByParams: boolean = true;\n\n\t#listElm: HTMLElement;\n\t#keyToUis: Map<string, [string, string, string, [HTMLInputElement, HTMLInputElement|null, HTMLInputElement[]|null]]> = new Map();\n\t#stopUpdate: boolean = false;\n\n\t/**\n\t * Represents a filtering mechanism for manipulating lists based on user-defined criteria.\n\t */\n\tconstructor(id: string, opts = {} as {[k in string]: string|boolean}) {\n\t\tthis.#assignOptions(opts);\n\n\t\tconst f = document.querySelector(`${this.#selFilter}[for=\"${id}\"]`) as HTMLElement;\n\t\tconst l = document.querySelector(`${this.#selList}#${id}`);\n\t\tif (!f || !l) {\n\t\t\tthrow new Error();\n\t\t}\n\n\t\tthis.#listElm = l as HTMLElement;\n\n\t\tthis.#initFilter(id, f);\n\t\tthis.#initializeList();\n\n\t\tf.removeAttribute('hidden');\n\t}\n\n\t/**\n\t * Assigns options to the Filter instance based on the provided options object.\n\t *\n\t * @private\n\t * @param opts - Options object containing key-value pairs for configuration.\n\t */\n\t#assignOptions(opts = {} as {[k in string]: string|boolean}) {\n\t\tif (typeof (opts['selFilter'] ?? null) === 'string') this.#selFilter = opts['selFilter'] as string;\n\t\tif (typeof (opts['selList']   ?? null) === 'string') this.#selList   = opts['selList']   as string;\n\n\t\tif (typeof (opts['selFilterKey'] ?? null) === 'string') this.#selFilterKey = opts['selFilterKey'] as string;\n\n\t\tif (typeof (opts['selFilterSelect']   ?? null) === 'string') this.#selFilterSelect   = opts['selFilterSelect']   as string;\n\t\tif (typeof (opts['selFilterEnabled']  ?? null) === 'string') this.#selFilterEnabled  = opts['selFilterEnabled']  as string;\n\t\tif (typeof (opts['selFilterRelation'] ?? null) === 'string') this.#selFilterRelation = opts['selFilterRelation'] as string;\n\t\tif (typeof (opts['selFilterValues']   ?? null) === 'string') this.#selFilterValues   = opts['selFilterValues']   as string;\n\n\t\tif (typeof (opts['qvarBase']   ?? null) === 'string') this.#qvarBase   = opts['qvarBase']   as string;\n\t\tif (typeof (opts['dsQvarBase'] ?? null) === 'string') this.#dsQvarBase = opts['dsQvarBase'] as string;\n\t\tif (typeof (opts['dsQvar']     ?? null) === 'string') this.#dsQvar     = opts['dsQvar']     as string;\n\n\t\tif (typeof (opts['classBase']   ?? null) === 'string') this.#classBase   = opts['classBase']   as string;\n\t\tif (typeof (opts['dsClassBase'] ?? null) === 'string') this.#dsClassBase = opts['dsClassBase'] as string;\n\n\t\tif (typeof (opts['dsKey']   ?? null) === 'string') this.#dsKey   = opts['dsKey']   as string;\n\t\tif (typeof (opts['dsCount'] ?? null) === 'string') this.#dsCount = opts['dsCount'] as string;\n\t\tif (typeof (opts['dsDepth'] ?? null) === 'string') this.#dsDepth = opts['dsDepth'] as string;\n\n\t\tif (typeof (opts['doSetHeadingDepth']    ?? null) === 'boolean') this.#doSetHeadingDepth    = opts['doSetHeadingDepth']    as boolean;\n\t\tif (typeof (opts['doInitializeByParams'] ?? null) === 'boolean') this.#doInitializeByParams = opts['doInitializeByParams'] as boolean;\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\t/**\n\t * Initializes the filter based on the provided ID and filter element.\n\t *\n\t * @private\n\t * @param id - Filter ID.\n\t * @param filterElm - Filter element.\n\t */\n\t#initFilter(id: string, filterElm: HTMLElement): void {\n\t\tconst fkElms = Array.from(filterElm.querySelectorAll(this.#selFilterKey)) as HTMLElement[];\n\n\t\tthis.#assignAttributes(id, fkElms);\n\n\t\tconst qvarBase = FilterCat.#nonEmpty(filterElm.dataset, this.#dsQvarBase) ?? this.#qvarBase;\n\t\tconst rClsBase = FilterCat.#nonEmpty(filterElm.dataset, this.#dsClassBase) ?? this.#classBase;\n\n\t\tfor (const e of fkElms) {\n\t\t\tconst key  = e.dataset[this.#dsKey];\n\t\t\tif (!key) continue;\n\t\t\tconst qvar = FilterCat.#nonEmpty(e.dataset, this.#dsQvar) ?? qvarBase.replace('%key%', key);\n\t\t\tconst cls  = (FilterCat.#nonEmpty(e.dataset, this.#dsClassBase) ?? rClsBase).replace('%key%', key);\n\n\t\t\tconst sel = e.querySelector(this.#selFilterSelect) as HTMLInputElement;\n\t\t\tif (sel) {\n\t\t\t\tthis.#keyToUis.set(key, [cls, qvar, 'select', [sel, null, null]]);\n\t\t\t} else {\n\t\t\t\tconst ena = e.querySelector(this.#selFilterEnabled) as HTMLInputElement;\n\t\t\t\tconst rel = e.querySelector(this.#selFilterRelation) as HTMLInputElement;\n\t\t\t\tconst cbs = Array.from(e.querySelectorAll(this.#selFilterValues + ' input')) as HTMLInputElement[];\n\t\t\t\tthis.#keyToUis.set(key, [cls, qvar, 'checkbox', [ena, rel, cbs]]);\n\t\t\t}\n\t\t}\n\t\tfor (const [_key, [_cls, _qvar, type, es]] of this.#keyToUis) {\n\t\t\tthis.#assignEventListener(type, es);\n\t\t}\n\t\tif (this.#doInitializeByParams) {\n\t\t\tthis.#stopUpdate = true;\n\t\t\tthis.#getStateFromUrlParams();\n\t\t\tthis.#stopUpdate = false;\n\t\t}\n\t\tthis.#update();\n\t}\n\n\t/**\n\t * Assigns UI element attributes based on the filter ID and key elements.\n\t *\n\t * @private\n\t * @param id - Filter ID.\n\t * @param fkElms - Filter key elements.\n\t */\n\t#assignAttributes(id: string, fkElms: HTMLElement[]): void {\n\t\tfor (const fk of fkElms) {\n\t\t\tconst key = fk.dataset[this.#dsKey];\n\t\t\tif (!key) continue;\n\t\t\tsetIdFor(fk, this.#selFilterEnabled, key, 'enabled', id);\n\t\t\tsetIdFor(fk, this.#selFilterRelation, key, 'relation', id);\n\n\t\t\tconst s = fk.querySelector(this.#selFilterSelect) as HTMLInputElement;\n\t\t\tif (s) s.name = `select-${key}`;\n\t\t\tconst cbs = Array.from(fk.querySelectorAll(this.#selFilterValues + ' input')) as HTMLInputElement[];\n\t\t\tfor (const cb of cbs) cb.name = `${key}-${cb.value}`;\n\t\t}\n\n\t\tfunction setIdFor(fk: HTMLElement, sel: string, key: string, prefix: string, suffix: string): void {\n\t\t\tconst fe = fk.querySelector(sel);\n\t\t\tif (!fe) return;\n\n\t\t\tfe.id = `${prefix}-${key}-${suffix}`;\n\n\t\t\tlet e = fe;\n\t\t\twhile (e.nextElementSibling) {\n\t\t\t\te = e.nextElementSibling;\n\t\t\t\tif (e.tagName !== 'LABEL') break;\n\t\t\t\te.setAttribute('for', fe.id);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Updates the list based on the current filter criteria.\n\t *\n\t * @private\n\t */\n\t#update(): void {\n\t\tif (this.#stopUpdate) {\n\t\t\treturn;\n\t\t}\n\t\tconst keyToVals = this.#getKeyToVals();\n\n\t\tthis.#fixListHeight();\n\t\tthis.#filterLists(keyToVals);\n\t\tthis.#countUpItems();\n\t\tthis.#freeListHeight();\n\n\t\tthis.#setUrlParams(keyToVals);\n\t}\n\n\n\t// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n\n\t/**\n\t * Assigns event listeners to UI elements based on the UI type and elements.\n\t *\n\t * @private\n\t * @param type - UI type (select or checkbox).\n\t * @param es - UI elements.\n\t */\n\t#assignEventListener(type: string, es: [HTMLInputElement, HTMLInputElement|null, HTMLInputElement[]|null]): void {\n\t\tif (type === 'select') {\n\t\t\tconst [sel] = es;\n\t\t\tsel.addEventListener('change', () => this.#update());\n\t\t} else if (type === 'checkbox') {\n\t\t\tconst [ena, rel, cbs] = es;\n\t\t\tif (ena && cbs) {\n\t\t\t\tena.addEventListener('click', () => {\n\t\t\t\t\tif (ena.checked && !this.#isCheckedAtLeastOne(cbs)) {\n\t\t\t\t\t\tfor (const cb of cbs) cb.checked = true;\n\t\t\t\t\t}\n\t\t\t\t\tif (!ena.checked && this.#isCheckedAll(cbs)) {\n\t\t\t\t\t\tfor (const cb of cbs) cb.checked = false;\n\t\t\t\t\t}\n\t\t\t\t\tthis.#update();\n\t\t\t\t});\n\t\t\t\tfor (const cb of cbs) {\n\t\t\t\t\tcb.addEventListener('click', () => {\n\t\t\t\t\t\tena.checked = this.#isCheckedAtLeastOne(cbs);\n\t\t\t\t\t\tthis.#update();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (rel) {\n\t\t\t\trel.addEventListener('click', () => this.#update());\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Checks if at least one checkbox is checked among the provided checkboxes.\n\t *\n\t * @private\n\t * @param cbs - Checkboxes to check.\n\t * @returns Whether any checkbox is checked\n\t */\n\t#isCheckedAtLeastOne(cbs: HTMLInputElement[]): boolean {\n\t\tfor (const cb of cbs) {\n\t\t\tif (cb.checked) return true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Check if all checkboxes are checked.\n\t *\n\t * @private\n\t * @param cbs - Checkboxes to check.\n\t * @returns Whether all checkboxes are checked\n\t */\n\t#isCheckedAll(cbs: HTMLInputElement[]): boolean {\n\t\tfor (const cb of cbs) {\n\t\t\tif (!cb.checked) return false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Gets the key-to-values mapping based on the current state of filters.\n\t *\n\t * @private\n\t * @returns Key-to-values mapping representing the filter criteria.\n\t */\n\t#getKeyToVals(): KeyToVals {\n\t\tconst kvs = new Map();\n\t\tfor (const [key, [cls, qvar, type, es]] of this.#keyToUis) {\n\t\t\tif (type === 'select') {\n\t\t\t\tconst [sel] = es;\n\t\t\t\tif (sel && '' !== sel.value) {\n\t\t\t\t\tkvs.set(key, ['or', [sel.value], cls, qvar]);\n\t\t\t\t}\n\t\t\t} else if (type === 'checkbox') {\n\t\t\t\tconst [ena, rel, cbs] = es;\n\t\t\t\tif (ena && rel && cbs && ena.checked) {\n\t\t\t\t\tconst oa = (rel && rel.checked) ? 'and' : 'or';\n\t\t\t\t\tkvs.set(key, [oa, this.#getCheckedVals(cbs), cls, qvar]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn kvs;\n\t}\n\n\t/**\n\t * Gets the array of checked values from a group of checkboxes.\n\t *\n\t * @private\n\t * @param cbs - Checkboxes to retrieve checked values from.\n\t * @returns Array of checked values.\n\t */\n\t#getCheckedVals(cbs: HTMLInputElement[]): string[] {\n\t\tconst vs: string[] = [];\n\t\tfor (const cb of cbs) {\n\t\t\tif (cb.checked) vs.push(cb.value);\n\t\t}\n\t\treturn vs;\n\t}\n\n\n\t// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n\n\t/**\n\t * Gets the current state of filters from URL parameters and updates the filter accordingly.\n\t *\n\t * @private\n\t */\n\t#getStateFromUrlParams(): void {\n\t\tconst usp = new URLSearchParams(document.location.search);\n\n\t\tfor (const [_key, [_cls, qvar, type, es]] of this.#keyToUis) {\n\t\t\tif (!usp.has(qvar)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet v = usp.get(qvar) as string;\n\t\t\tlet oa = 'or';\n\t\t\tif (v.startsWith('.')) {\n\t\t\t\tv = v.substring(1);\n\t\t\t\toa = 'and';\n\t\t\t}\n\t\t\tif (type === 'select') {\n\t\t\t\tconst [sel] = es;\n\t\t\t\tsel.value = v;\n\t\t\t} else if (type === 'checkbox') {\n\t\t\t\tconst [ena, rel, cbs] = es;\n\t\t\t\tif (ena) ena.checked = true;\n\t\t\t\tif (rel) rel.checked = (oa === 'and');\n\t\t\t\tif (cbs) {\n\t\t\t\t\tconst vs = new Set(v.split(',').map(e => e.trim()));\n\t\t\t\t\tfor (const cb of cbs) {\n\t\t\t\t\t\tcb.checked = vs.has(cb.value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Sets URL parameters based on the current state of filters.\n\t *\n\t * @private\n\t * @param keyToVals - Mapping of filter keys to their values.\n\t */\n\t#setUrlParams(keyToVals: KeyToVals): void {\n\t\tconst rs = { or: '', and: '.' };\n\t\tconst ps: string[] = [];\n\t\tfor (const [_key, [oa, vs, _cls, qvar]] of keyToVals) {\n\t\t\tif (vs.length) {\n\t\t\t\tps.push(`${qvar}=${rs[oa]}${vs.join(',')}`);\n\t\t\t}\n\t\t}\n\t\tlet url;\n\t\tif (ps.length > 0) {\n\t\t\turl = '?' + ps.join('&');\n\t\t} else {\n\t\t\turl = document.location.origin + document.location.pathname;\n\t\t}\n\t\thistory.replaceState('', '', url + document.location.hash);\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\t/**\n\t * Initializes the list by assigning depth values to heading elements.\n\t *\n\t * @private\n\t */\n\t#initializeList() {\n\t\tconst assignDepth = () => {\n\t\t\tfor (const h of this.#listElm.children) {\n\t\t\t\tif (!(h instanceof HTMLHeadingElement)) continue;\n\t\t\t\t(h as HTMLElement).dataset[this.#dsDepth] = String(parseInt(h.tagName[1]) - 1);\n\t\t\t}\n\t\t}\n\t\tif (this.#doSetHeadingDepth) {\n\t\t\tassignDepth();\n\t\t}\n\t}\n\n\n\t// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n\n\t/**\n\t * Fixes the height of lists to prevent layout shifts.\n\t *\n\t * @private\n\t */\n\t#fixListHeight() {\n\t\tfor (const e of this.#listElm.children) {\n\t\t\tif (!(e instanceof HTMLElement)) continue;\n\t\t\tif (e.tagName !== 'OL' && e.tagName !== 'UL') continue;\n\n\t\t\tconst h = e.offsetHeight;\n\t\t\te.setAttribute('style', `--height:${h}px;`);\n\t\t}\n\t}\n\n\t/**\n\t * Frees the height of lists after filtering is complete.\n\t *\n\t * @private\n\t */\n\t#freeListHeight() {\n\t\tfor (const e of this.#listElm.children) {\n\t\t\tif (!(e instanceof HTMLElement)) continue;\n\t\t\tif (e.tagName !== 'OL' && e.tagName !== 'UL') continue;\n\n\t\t\te.removeAttribute('style');\n\t\t}\n\t}\n\n\n\t// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n\n\t/**\n\t * Filter lists based on the provided key-value mapping.\n\t *\n\t * @private\n\t * @param keyToVals - Mapping of filter keys to their values\n\t */\n\t#filterLists(keyToVals: KeyToVals): void {\n\t\tfor (const e of this.#listElm.children) {\n\t\t\tif (!(e instanceof HTMLElement)) continue;\n\t\t\tif (e.tagName !== 'OL' && e.tagName !== 'UL') continue;\n\n\t\t\tlet count = 0;\n\t\t\tfor (const li of e.children) {\n\t\t\t\tif (li.tagName !== 'LI') continue;\n\n\t\t\t\tif (this.#isMatch(li, keyToVals)) {\n\t\t\t\t\tcount += 1;\n\t\t\t\t\tli.removeAttribute('hidden');\n\t\t\t\t} else {\n\t\t\t\t\tli.setAttribute('hidden', '');\n\t\t\t\t}\n\t\t\t}\n\t\t\te.dataset[this.#dsCount] = String(count);\n\t\t}\n\t}\n\n\t/**\n\t * Checks if a list item matches the provided filter values.\n\t *\n\t * @private\n\t * @param li - List item element.\n\t * @param keyToVals - Mapping of filter keys to their values.\n\t * @returns Whether the list item matches the filter values.\n\t */\n\t#isMatch(li: Element, keyToVals: KeyToVals): boolean {\n\t\tfor (const [_key, [oa, vs, cls]] of keyToVals) {\n\t\t\tif (!this.#isMatchOne(li, vs, cls, 'or' === oa)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Checks if a list item matches a single filter value.\n\t *\n\t * @private\n\t * @param li - List item element.\n\t * @param vs - Filter values.\n\t * @param cls - Class name pattern.\n\t * @param isOr - Whether it's an 'or' operation.\n\t * @returns Whether the list item matches the filter value.\n\t */\n\t#isMatchOne(li: Element, vs: string[], cls: string, isOr: boolean): boolean {\n\t\tif (isOr) {\n\t\t\tfor (const v of vs) {\n\t\t\t\tconst c = cls.replace('%value%', v).replace('_', '-');\n\t\t\t\tif (li.classList.contains(c)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t} else {\n\t\t\tfor (const v of vs) {\n\t\t\t\tconst c = cls.replace('%value%', v).replace('_', '-');\n\t\t\t\tif (!li.classList.contains(c)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t}\n\n\n\t// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n\n\t/**\n\t * Counts up the number of items under each heading and updates their visibility.\n\t *\n\t * @private\n\t */\n\t#countUpItems(): void {\n\t\tfor (const e of this.#listElm.children) {\n\t\t\tif (!(e instanceof HTMLElement)) continue;\n\n\t\t\tif (e.dataset[this.#dsDepth]) e.dataset[this.#dsCount] = '0';  // 'e' is heading\n\t\t}\n\t\tconst hs: HTMLElement[] = [];\n\t\tfor (const e of this.#listElm.children) {\n\t\t\tif (!(e instanceof HTMLElement)) continue;\n\n\t\t\tif (e.dataset[this.#dsDepth]) {  // 'e' is heading\n\t\t\t\tconst hi = parseInt(e.dataset[this.#dsDepth] ?? '');\n\t\t\t\twhile (hs.length > 0) {\n\t\t\t\t\tconst l = hs[hs.length - 1];\n\t\t\t\t\tif (hi > parseInt(l.dataset[this.#dsDepth] ?? '')) break;\n\t\t\t\t\ths.length -= 1;\n\t\t\t\t}\n\t\t\t\ths.push(e);\n\t\t\t} else {  // 'e' is list\n\t\t\t\tconst count = parseInt(e.dataset[this.#dsCount] ?? '');\n\t\t\t\tfor (const h of hs) {\n\t\t\t\t\tconst sum = parseInt(h.dataset[this.#dsCount] ?? '') + count;\n\t\t\t\t\th.dataset[this.#dsCount] = String(sum);\n\t\t\t\t\tif (sum) {\n\t\t\t\t\t\th.removeAttribute('hidden');\n\t\t\t\t\t} else {\n\t\t\t\t\t\th.setAttribute('hidden', '');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n"],
  "mappings": "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",
  "names": ["FilterCat", "#idx", "opts", "selFilter", "selList", "fs", "ls", "f", "id", "#nonEmpty", "arr", "key", "v", "#selFilter", "#selList", "#selFilterKey", "#selFilterSelect", "#selFilterEnabled", "#selFilterRelation", "#selFilterValues", "#qvarBase", "#dsQvarBase", "#dsQvar", "#classBase", "#dsClassBase", "#dsKey", "#dsCount", "#dsDepth", "#doSetHeadingDepth", "#doInitializeByParams", "#listElm", "#keyToUis", "#stopUpdate", "#assignOptions", "l", "#initFilter", "#initializeList", "filterElm", "fkElms", "#assignAttributes", "qvarBase", "rClsBase", "e", "qvar", "cls", "sel", "ena", "rel", "cbs", "_key", "_cls", "_qvar", "type", "es", "#assignEventListener", "#getStateFromUrlParams", "#update", "fk", "setIdFor", "s", "cb", "prefix", "suffix", "fe", "keyToVals", "#getKeyToVals", "#fixListHeight", "#filterLists", "#countUpItems", "#freeListHeight", "#setUrlParams", "#isCheckedAtLeastOne", "#isCheckedAll", "kvs", "oa", "#getCheckedVals", "vs", "usp", "rs", "ps", "url", "assignDepth", "h", "count", "li", "#isMatch", "#isMatchOne", "isOr", "c", "hs", "hi", "sum"]
}
